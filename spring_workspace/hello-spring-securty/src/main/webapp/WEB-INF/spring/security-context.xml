<?xml version="1.0" encoding="UTF-8"?>
<!-- beans 네임스페이스가 원래 기본 namespace
	 편의성을 위해 security를 기본 namespace로 바꾸기
	 -> security는 앞의 pefix인 namespace생략하고 사용 가능
	 -> beans는 앞에 namespace를 붙여야함
-->
<beans:beans
	xmlns="http://www.springframework.org/schema/security"
	xmlns:beans="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/security 
		http://www.springframework.org/schema/security/spring-security.xsd">

	<!-- #4. 암호화인코딩 빈등록 : BCryptPasswordEncoder -->
	<!-- 암호화처리할 빈 등록 -->
	<beans:bean id="bcryptPasswordEncoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"></beans:bean>
	
	<!-- #5. 권한체크 설정 -->
	<!-- 정적파일(css, javascript...) 을 권한검사에서 제외 -->
	<!-- security속성을 none으로 : 검사하지 마라 -->
	<!-- pattern속성으로 어떤 파일들에 대해 제외시킬지 -->
	<http security="none" pattern="/resources/**/"></http>
	<!-- auto-cofig속성을 true로 : 하위 기타 설정들을 자동으로 해줌 -->
	<http auto-config="true">
		<!-- intercept-url은 여러개 등록 가능 -->
		<!-- pattern : /(인덱스페이지)에 대해
			 access : permitAll - 모두 승인하라 -->
		<intercept-url pattern="/" access="permitAll"/>
		<!-- 내부적으로 포워딩하는 index.jsp에 대해서도 모두 승인 -->
		<intercept-url pattern="/index.jsp" access="permitAll"/>
		<!-- pattern : admin으로 시작하는 모든 요청은
			 access : admin권한이 있어야 한다 -->
		<intercept-url pattern="/admin/**" access="hasRole('ADMIN')"/>
		<!-- pattern : /** 이런 url요청(모든 요청)이 있다면
			 access : USER권한이 있는지 검사하자 -->
		<intercept-url pattern="/**" access="hasRole('USER')"/>
	</http>	
	
	<!-- #6. 인증/권한 검사 manager bean 설정 -->
	<!-- 인증/권한 검사를 주도적으로 실행할 bean -->
	<!-- 인증 : authentication
		 권한 : authority -->
	<authentication-manager>
		<!-- authentication-provider : 구현체 -->
		<authentication-provider>
			<!-- 위에 설정한 사용할 passwordEncoder 등록 -->
			<password-encoder ref="bcryptPasswordEncoder"/>
			<!-- (임시) 사용자를 여기에 등록해둠 -->
			<user-service>
				<!-- honggd : 사용자 권한만 부여
					 보통 권한 앞에는 ROLE_ 접두사 붙임 -->
				<user name="honggd"
					  password="$2a$10$6wLRctSpj6rDSkoDPNdUSeN3mO/lfhAJzD083EZ13sVgT/gPyMeUa"
					  authorities="ROLE_USER"/>
				<!-- admin : 사용자 권한, 관리자 권한 -->
				<user name="admin"
					  password="$2a$10$6wLRctSpj6rDSkoDPNdUSeN3mO/lfhAJzD083EZ13sVgT/gPyMeUa"
					  authorities="ROLE_USER,ROLE_ADMIN"/>
			</user-service>
		</authentication-provider>
	</authentication-manager>
</beans:beans>
