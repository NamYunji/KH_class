<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
<!-- ================== 전체 게시글 조회 ================== -->
<select id="selectBoardList" resultMap="boardExtMap">
<!-- 첨부파일이 있는지도 처리 -->
	select
		b.*,
		(select count(*) from attachment where board_no = b.no) attach_count
	from
		board b
	order by
		no desc
</select>
<resultMap type="boardExt" id="boardExtMap">
	<!-- 숫자 -> 자동으로 boolean 형변환해줌 -->
	<result column="attach_count" property="hasAttachment"/>
</resultMap>
<!-- ================== 전체 게시글 수 조회 ================== -->
<select id="selectBoardTotalContents" resultType="_int">
	select
		count(*)
	from
		board
</select>
<!-- =========
========= 게시글 추가 ================== -->
<insert id="insertBoard">
	insert into
		board(
			no,
			title,
			member_id,
			content
		)
	values (
		seq_board_no.nextval,
		#{title},
		#{memberId},
		#{content}
	)
</insert>
<!-- ================== 첨부파일 추가 ================== -->
<insert id="insertAttachment">
	insert into
		attachment(
			no,
			board_no,
			original_filename,
			renamed_filename
		)
	values(
		seq_attachment_no.nextval,
		#{boardNo}
		#{originalFilename},
		#{renamedFilename}		
	)
</insert>
</mapper>